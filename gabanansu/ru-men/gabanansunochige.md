# ガバナンスの立ち上げ段階

#### 概要

EulerDAOは、Eulerプロトコルの完全な分散化に向けて、3つのフェーズに分けて慎重に開始されます。各フェーズについて、以下に説明します。 EulerDAOは、 [OpenZeppelin Governance smart contracts](https://github.com/OpenZeppelin/openzeppelin-contracts/tree/master/contracts/governance) バージョン4.6.0）をガバナンスに使用します（EULトークンコントラクトも同様です）。これは、ガバナンスプロトコル - Compoundが使用しているものに似ています - であり、代表者はEulerDAOとEulerプロトコルに変更を加えるためのアクティブな提案に投票します。 Eulerは、ガバナンスプロセスを管理するために、Tallyガバナンスダッシュボードアプリケーションを使用しています。Tallyを通じて、自分のウォレットをデリゲートにするための設定、オンチェーンプロポーザルの作成、アクティブなプロポーザルに対する投票、コミュニティ内のデリゲートの発見、コミュニティメンバーへの投票権の委譲を行うことができます。

#### フェーズ 1

立ち上げの最初のフェーズでは、Eulerプロトコルのスマートコントラクト上で直接実行されるアクションが、コミュニティに代わってEulerチームによって実行されるようなものになる予定です。この場合、すべてのオンチェーンガバナンス提案は、（Eulerプロトコルのスマートコントラクトの代わりに） [stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) 内の`executeProposal(string description, bytes proposalData)`関数を指すか、ターゲットにします。 提案が成功し実行されると、ターゲット関数が（TimelockControllerコントローラのスマートコントラクトを介して）実行されます。これは提案の説明文字列と提案のトランザクションデータを出力し、Eulerチームによって検証された後、Euler multisigを介してExecモジュールに対して実行されます。 したがって、Euler Governanceモジュールのスマートコントラクトの`goverOnly()`修飾子は、その関数の呼び出し元がTimelockControllerスマートコントラクトではなくEuler mulisigであることを確認することになる。 提案のトランザクションデータを作成するために、提案者が実行すべきアクションに応じてこれを自動生成するのに役立つ [tool](https://proposal.euler.finance/) を実装しています。 提案者は、ドロップダウンのトークンリストからトークンを選択し（これは、Euler上のトークン/市場の現在の構成でフィールドに自動入力されます）、提案者は修正を加えて、Euler Execモジュール（batchDispatch()関数）を介して実行する提案取引Hexを生成し、Tallyで提案を作成するときに、このHexデータを [stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) のターゲット関数の入力として使用することができます。

トークン保有者が投票する可能性のある決定事項の例としては、以下のようなものが挙げられます。

* 資産の階層
* 担保・借入要因
* 価格オラクルパラメータ
* リアクティブ金利モデルパラメータ
* リザーブファクター

#### フェーズ 2

第二段階では、Euler Governanceモジュールのガバナー管理者は、Euler multisigからTimelockControllerスマートコントラクトに切り替わります。したがって、Euler [Governance module](https://github.com/euler-xyz/euler-contracts/blob/master/contracts/modules/Governance.sol) のスマートコントラクトの`governOnly()`修飾子は、その関数の呼び出し元がTimelockControllerスマートコントラクトであることを確認することになる。 この場合、Tallyガバナンスダッシュボード経由で作成されたプロポーザルは、Eulerガバナンスモジュールを直接ターゲットにする必要があります。そして、より多くの支持票を得た成功した提案は、Eulerチームのコントロールなしに実行されます。 実行中、TimelockControllerスマートコントラクトは、オンチェーンプロポーザル内で指定されたEuler Governanceモジュールのターゲット関数を呼び出します。提案者は、Euler Governanceモジュール内で実行されるアクション/関数のバッチを1つのオンチェーン提案に追加することもできます。

#### フェーズ 3

このフェーズでは、Installer AdminもTimelockControllerスマートコントラクトに切り替わる予定です。 コミュニティは、アセット設定変更のための Governance モジュールを制御できるだけでなく、インストーラーモジュールを含むプロトコルを完全に制御することができます。このモジュールは、残りのモジュールをブートストラップでインストールするために使用され、後で新しい機能を追加したり、バグを修正するためにモジュールをアップグレードするために使用することができます。

### ガバナンス提案書作成ツール フェーズ 1

#### 概要

EulerのDAO / ガバナンスの立ち上げの最初の段階は、Eulerプロトコルのスマートコントラクト上で直接実行されるアクションが、コミュニティの代わりにEulerチームによって実行または実行される場所となります。この場合、すべてのオンチェーンガバナンスの提案は、（Eulerプロトコルのスマートコントラクトの代わりに）[stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) の機能を指す、またはターゲットにします。 提案が成功し実行されると、ターゲットとなる関数が実行されます（TimelockControllerコントローラーのスマートコントラクトを経由します。これは提案の説明文字列と提案トランザクションのHexデータを出力し、Eulerチームによって検証され、（OpenZeppelin Defender上の）Euler multisigを介して`Exec`モジュールに対して実行されます。 したがって、 [Euler Governance module](https://github.com/euler-xyz/euler-contracts/blob/master/contracts/modules/Governance.sol) の `governorOnly()` 修飾子は、その関数の呼び出し元が DAO の TimelockController スマートコントラクトではなく Euler mulisig であることを確認することになります。 提案取引データを作成するために、提案作成者がどのようなアクションを実行すべきかに応じて自動生成するための [tool](https://proposal.euler.finance/) を実装しています。提案取引データは、ExecモジュールのbatchDispatch関数に対するオンチェーントランザクションを単純にエンコードしたものです。 この後は、提案取引データをEulerのガバナンス提案作成ツールで作成し、生成された提案取引データを使って [Tally](https://www.tally.xyz/) ガバナンスダッシュボードでオンチェーン提案を作成するまでの流れを説明します。

### セクション 1, EulerのExecモジュールの提案取引データを作成する。

**ステップ 1**

[proposal transaction data creation tool](https://proposal.euler.finance/)に移動します。 Webアプリケーションは次の画像のようになっているはずです。

**ステップ 2**

このツールを使用するには、ブラウザにMetaMaskがインストールされている必要があります。MetaMaskのウォレットをメインネットに切り替えてください。 このツールは現在、Ethereum Mainnetと私たちのGoerli testnet Execモジュールに対応しています。選択したネットワークに応じて、実行する適切なトランザクションデータを作成します。

**ステップ 3**

ウィンドウの左上には、提案の説明のためのテキストフィールドがあり、その下には、USDC、DAIなどのトークンのリストを表すドロップダウンメニューがあります。 ウィンドウの左側、トークン一覧の下には、現在のトークン構成が自動入力される一連のドロップダウンメニューとテキストフィールドがあります（トークンがEuler上で有効なマーケットを持っている場合）。 提案者は、提案データを作成するために、提案の説明を入力し、トークン一覧からトークンを選択する必要があります。一度選択すると、残りのフィールドには、トークンまたはEuler上のマーケットの現在の構成が自動的に入力されます（マーケットがアクティブになっている場合）。 下の画像は、提案の説明と左側のフィールドに、Euler上のUSDCの現在の市場構成が入力されていることを示しています。

**ステップ 4**

提案者は、Tally上で提案を作成する際に、Euler Execモジュール（`batchDispatch()`関数）を介して実行される提案取引のHexデータを修正・生成し、このHexデータを [stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) のターゲット関数の入力として使用します（これについては、以下の2章で説明します）。 例として、USDCの借入係数を0.6に変更してみましょう。そのためには、画面左側の担保係数のテキストフィールドで、現在の担保係数を0.6に変更し、CREATE PROPOSAL DATAをクリックするだけです。そうすると、アセットに加えたい変更を示すマークダウンテーブルが表示されるはずです。また、Tally上のオンチェーンガバナンス提案 [stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) に必要なバッチアイテムHexトランザクションデータも表示されるでしょう。 注：このプロセスは、複数のトークンと構成（または同じトークンの複数の構成）に対して繰り返すことができます。これらは一括して追加され、Euler ExecモジュールのbatchDispatch機能用のトランザクションデータを形成するためにエンコードされます。 たとえば、トークン・リストからDAIを選択し、DAIのボロー・ファクターを0.3に変更してみましょう。ここでも、DAIを選択し、ボローファクターを0.3に変更して`CREATE PROPOSAL DATA`をクリックすると、フィールドに自動的に入力されます。構成更新のリストは、DAIに加える変更を反映するように更新されますが、USDCの更新情報はまだ残っています。トランザクションヘックスも更新されます。

**ステップ 5**

選択した更新を検証するには、バッチ項目のhex TX data（バッチ項目の下、つまり提案の説明の下）の自動生成されたhexをコピーし、`DEBUG TX HEX DATA`をクリックしてコピーしたhexをテキストフィールドに貼り付けます。 ツールは16進数をデコードし、提案が実行された後にEulerチームが選択したトークンに適用する更新を示すマークダウンを表示するはずです。Eulerチームはこのプロセスに従って、コミュニティのためにExecモジュールでトランザクションを実行する前に、提案の説明文に行われる更新が反映されていることを確認することもできます。 上の画像に示すように、16進数のデータがデコードされ、DAIとUSDCに適用するために選択したアップデートが表示されます。ウィンドウの右下に閉じるボタンがあり、デバッグモーダルを閉じてメインページに戻ることができます。 ここまでくれば、これでプロポーザルの取引データができ、それを使ってTallyでオンチェーンプロポーザルを作成することができます。投票期間終了後、正常に実行された場合、デコードされた16進データはOpenZeppelin Defenderに提出され、コミュニティの代表としてオイラーチームが実行することになります。 ツールの使用中にご質問やご意見がありましたら、私たちのDiscord Governanceチャンネルでお知らせください。

### セクション 2, EulerのExecモジュール用に自動生成されたトランザクションデータを使って、Tally上のDAOのオンチェーンプロポーザルを作成する。

この時点で、Euler Exec モジュールの batchDispatch 関数に必要な提案トランザクションの hex データを持っていると仮定します。そして、コミュニティのメンバー（および代表者）が投票するためのオンチェーンプロポーザルを作成したいと思います。もしそうなら、ぜひ読んでみてください。 以下では、この目標を達成するために必要なステップを説明します。

**ステップ 1**

TallyのEulerDAOダッシュボードに向かい、MetaMaskウォレットを接続します。

**ステップ 2**

ウィンドウの右隅にある`Create new proposa`lをクリックします。 すると、以下のような提案書作成画面が表示されます。  `Continue` をクリックして、次のステップ（`Name your proposal`）に進みます。

**ステップ 3**

提案書のタイトルと説明を入力し、`Continue`をクリックします。

**ステップ 4**

次のセクションでは、ガバナンス・プロポーザルのアクション、すなわちターゲット・スマートコントラクト、ターゲット関数、パラメータを指定することが必要になります。Tallyダッシュボードでは、プロポーザルが成功し実行された場合に呼び出される/実行されるアクションを1つのプロポーザルで複数指定することが可能です。 1項の提案トランザクションヘクスを追加し、ターゲットスマートコントラクトとしてガバナンス [stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) を設定するために、`Add custom action`をクリック⇒ターゲットスマートコントラクトとして [stub governance smart contract](https://etherscan.io/address/0x8233f21dda26229c8b0586c3c2521be5da0e6328) のアドレスを入力します。そして、ターゲットスマートコントラクトのターゲット関数として、`contract method`のドロップダウンメニューから`executeProposal`関数を選択します。ここで興味深いのは、必要なパラメータ、つまり提案の説明文字列と、セクション1の提案トランザクションヘックスデータであるproposalDataを入力する点です。

**ステップ 5**

完了したら、Continueをクリックし、プロポーザルを確認します。満足したら、`Submit on-chain`をクリックすると、MetaMaskのポップアップウィンドウが開き、Governanceスマートコントラクトを介して、オンチェーンで提案を作成するためのトランザクションに署名することができるようになります。
